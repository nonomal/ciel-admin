<!--
=================================================================================
 This is auto-generated by Freekey Admin at 2022-09-04 20:32:44. For more information see https://github.com/1211ciel/ciel-admin
=================================================================================
-->

<!DOCTYPE html>
<html lang="zh">
<head>
    {{include "/part/meta.html" .}}
    <title>{{.node.Name}} - {{.Config.server.name}} </title>
    <style>
    </style>
</head>
<body>
{{include "/part/top.html" .}}
<div id="wrapper">
    <div class="w">
        <div id="wrapper-left">
            {{include "/part/nav.html" .}}
            <div class="box-02 no-bottom-border">
                {{include "/part/page_base_info.html" .}}
                <form class="cell flex-center no-bottom-border p-3" action="/admin/gold" method="get">
                    <span class="mr-auto"></span>
                    {{searchPageSize .Query}}
                    {{input "uname" "用户名" .Query}}
                    {{options "status" "状态" .Config.options.goldStatus .Query}}
                </form>
            </div>
            <div class="box-02 no-bottom-border">
                {{.msg}}
                <table class="table-1">
                    <tr>{{th "ID,用户名,金币,备注,状态,UPDATED_AT,OPERATION"}}</tr>
                    {{range .list}}
                    <tr>
                        {{td "id" .id}}
                        {{td "用户名" .uname}}
                        <td><span class="tag-5">{{.balance|balance}}</span></td>
                        {{td "备注" .desc}}
                        {{tdChoose "status" $.Config.options.goldStatus .status}}
                        {{td "updated_at" .updated_at}}
                        <td align="center">
                            {{a "tag-warning" (concat "/admin/gold/edit/" .id) "修改" $.Query}}
                            {{aFun "tag-success" "修改密码" (concat "updatePass(" .uid ")") }}
                            {{a "tag-warning" (concat "/admin/gold/topUp/" .uid) "充值" $.Query}}
                            {{a "tag-info" (concat "/admin/gold/deduct/" .uid) "扣除" $.Query}}
                            {{aDel (concat "/admin/gold/del/" .id) $.Query}}
                        </td>
                    </tr>
                    {{end}}
                </table>
                {{include "/part/pagination.html" .}}
            </div>
        </div>
    </div>
</div>
{{include "/part/footer.html" .}}
{{include "/part/endJs.html" .}}
<script>
    async function updatePass(uid) {
        let pass = prompt('请输入新的密码')
        if (pass) {
            const {msg} = await $.put('/admin/gold/updatePassByAdmin', {uid, pass})
            alert(msg)
        }
    }

    async function topUp() {
        const {code, msg} = await $.post('/admin/gold/topUpByAdmin', $("#top-up-form").serialize())
        alert(msg)
        if (code === 0) {
            location.reload()
        }
    }

    async function deduct(uid) {
        let type = prompt('选择扣除类型:5 人工扣除')
        if (type) {
            let desc = ''
            switch (+type) {
                case 5:
                    desc = '人工扣除'
                    break
                default:
                    alert('请输入正确的选项')
                    return
            }
            let amount = prompt('扣除金额')
            if (confirm(`您选择了${desc}类型${amount}金额，确认扣除?`)) {
                const {code, msg} = await $.post('/admin/gold/deductByAdmin', {type, uid, amount})
                alert(msg)
                if (code === 0) {
                    location.reload()
                }
            }
        }
    }
</script>
</body>
</html>