<!--
=================================================================================
 This is auto-generated by Freekey Admin at 2022-06-27 19:10:03. For more information see https://github.com/1211ciel/ciel-admin
=================================================================================
-->
<!DOCTYPE html>
<html lang="zh">
<head>
    {{include "/part/meta.html" .}}
    <title>添加role_api - {{.Config.server.name}}</title>
</head>
<body>
{{include "/part/top.html" .}}
<div id="wrapper">
    <div class="w">
        <div id="wrapper-left">
            <div class="box no-bottom-border">
                <div class="cell flex-center">
                    {{imgSettings}}
                    {{a "ml-12" "/admin/roleApi" "返回" .Query}}
                </div>
                {{.msg}}
                <div class="cell">
                    {{a "link-2-active" "#" "添加角色禁用API"}}
                </div>
                <form id="form" class="cell" method="post" action="/admin/roleApi/post?{{toUrlParams .Query}}">
                    <table class="table-add">
                        {{editTrReadonly "rid" "角色id" .role.Id}}
                        {{editTrReadonly "name" "角色" .role.Name}}
                        <tr>
                            <td align="right">分组过滤</td>
                            <td><select id="group-options">
                                <option value="">请选择</option>
                                {{option .groups 0}}
                            </select></td>
                        </tr>
                        <tr>
                            <td width='160' align='right'>APIs</td>
                            <td width='auto' align='left'>
                                <select name='aid[]' multiple style="height: 333px;width: 600px"></select>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <a class="tag-success" href="#" onclick="handleChoose(5)">禁用访问页面</a>
                                <a class="tag-success" href="#" onclick="handleChoose(4)">禁用查询API</a>
                                <a class="tag-primary" href="#" onclick="handleChoose(1)">禁用添加API</a>
                                <a class="tag-warning" href="#" onclick="handleChoose(3)">禁用修改API</a>
                                <a class="tag-danger" href="#" onclick="handleChoose(2)">禁用删除API</a>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <button class="btn-warning" type="submit">提交</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </div>
</div>
{{include "/part/footer.html" .}}
{{include "/part/endJs.html" .}}
<script>
    let apis = JSON.parse('{{json .apis}}')
    let $select = $("select[name='aid[]']");
    $(function () {
        $select.html(apis.map(i => apiOptions(i.type, i.id, i.group, i.desc, i.url)))
    })
    const handleChoose = (type) => {
        $select.find(`option[data-type='${type}']`).attr('selected', true)
        $("#form").submit()
    }

    $("#group-options").on('change', function () {
        let v = this.value
        $select.html('')
        if (v) {
            $select.html(apis.filter(i => i.group === v).map((i) => apiOptions(i.type, i.id, i.group, i.desc, i.url)))
        } else {
            $select.html(apis.map((i) => apiOptions(i.type, i.id, i.group, i.desc, i.url)))
        }
    })

    function apiOptions(t, id, group, desc, url) {
        switch (t) {
            case 1:
                return `<option value="${id}" data-type="${t}"  class="tag-primary width-auto block">【${group}】【添加】 ${desc} (${url})</option>`
            case 2:
                return `<option value="${id}" data-type="${t}"  class="tag-danger width-auto block">【${group}】【删除】 ${desc} (${url})</option>`
            case 3:
                return `<option value="${id}" data-type="${t}"  class="tag-warning width-auto block">【${group}】【修改】 ${desc} (${url})</option>`
            case 4:
                return `<option value="${id}" data-type="${t}" class="tag-success width-auto block">【${group}】【查询】 ${desc} (${url})</option>`
            case 5:
                return `<option value="${id}" data-type="${t}" class="tag-success width-auto block">【${group}】【页面】 ${desc} (${url})</option>`
        }
    }
</script>
</body>
</html>