<!--
=================================================================================
 This is auto-generated by FreeKey Admin at 2022-06-27 20:13:23. For more information see https://github.com/1211ciel/ciel-admin
=================================================================================
-->
<!DOCTYPE html>
<html lang="zh">
<head>
    {{include "/part/meta.html" .}}
    <title>添加file - {{.Config.server.name}}</title>
</head>
<body>
{{include "/part/top.html" .}}
<div id="wrapper">
    <div class="w">
        <div id="wrapper-left">
            <div class="box no-bottom-border">
                <div class="cell flex-center">
                    {{imgSettings}}
                    {{a "ml-12" "/admin/file" "返回" .Query}}
                </div>
                {{.msg}}
                <div class="cell">
                    {{a "link-2-active" "#" "添加"}}
                </div>
                <div class="flex-center">
                    <form class="cell no-bottom-border" action="/admin/file/upload" enctype="multipart/form-data" method="post">
                        <table class="table-add">
                            <tr>
                                <td width='160' align='right'>文件</td>
                                <td width='auto' align='left'><input id="file" name='file' type="file" multiple></td>
                            </tr>
                            <tr>
                                <td align='right'>分组</td>
                                <td><select name='group' id="multiple-group">
                                    {{option .Config.options.fileGroup 5}}
                                </select>
                                </td>
                            </tr>
                            {{editTrSubmit}}
                        </table>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>
{{include "/part/footer.html" .}}
{{include "/part/endJs.html" .}}
</body>
<script>
    function getFiles() {
        let data = new FormData()
        let files = $('#file')[0].files
        for (let i = 0; i, files.length; i++) {
            let item = files[i]
            if (!item) {
                return data
            }
            data.append('file', item)
        }
        return data
    }

    async function uploadFile() {
        let data = getFiles();
        let g = $('#multiple-group').val()
        if (g == null) {
            alert('请选择分组')
            return
        }
        data.append("group", g)
        const res = await $.ajax({
            url: '/file/upload',
            type: 'post',
            cache: false,
            data: data,
            processData: false,
            contentType: false,
        })
        if (res.code === 0) {
            alert('ok')
        } else {
            alert(res.msg)
        }
    }
</script>
</html>